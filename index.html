<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>p0461r0: Proposed RCU C++ API</title>
<style data-fill-with="stylesheet">/******************************************************************************
 *                   Style sheet for the W3C specifications                   *
 *
 * Special classes handled by this style sheet include:
 *
 * Indices
 *   - .toc for the Table of Contents (<ol class="toc">)
 *     + <span class="secno"> for the section numbers
 *   - #toc for the Table of Contents (<nav id="toc">)
 *   - ul.index for Indices (<a href="#ref">term</a><span>, in Â§N.M</span>)
 *   - table.index for Index Tables (e.g. for properties or elements)
 *
 * Structural Markup
 *   - table.data for general data tables
 *     -> use 'scope' attribute, <colgroup>, <thead>, and <tbody> for best results !
 *     -> use <table class='complex data'> for extra-complex tables
 *     -> use <td class='long'> for paragraph-length cell content
 *     -> use <td class='pre'> when manual line breaks/indentation would help readability
 *   - dl.switch for switch statements
 *   - ol.algorithm for algorithms (helps to visualize nesting)
 *   - .figure and .caption (HTML4) and figure and figcaption (HTML5)
 *     -> .sidefigure for right-floated figures
 *   - ins/del
 *
 * Code
 *   - pre and code
 *
 * Special Sections
 *   - .note       for informative notes             (div, p, span, aside, details)
 *   - .example    for informative examples          (div, p, pre, span)
 *   - .issue      for issues                        (div, p, span)
 *   - .assertion  for assertions                    (div, p, span)
 *   - .advisement for loud normative statements     (div, p, strong)
 *   - .annoying-warning for spec obsoletion notices (div, aside, details)
 *
 * Definition Boxes
 *   - pre.def   for WebIDL definitions
 *   - table.def for tables that define other entities (e.g. CSS properties)
 *   - dl.def    for definition lists that define other entitles (e.g. HTML elements)
 *
 * Numbering
 *   - .secno for section numbers in .toc and headings (<span class='secno'>3.2</span>)
 *   - .marker for source-inserted example/figure/issue numbers (<span class='marker'>Issue 4</span>)
 *   - ::before styled for CSS-generated issue/example/figure numbers:
 *     -> Documents wishing to use this only need to add
 *        figcaption::before,
 *        .caption::before { content: "Figure "  counter(figure) " ";  }
 *        .example::before { content: "Example " counter(example) " "; }
 *        .issue::before   { content: "Issue "   counter(issue) " ";   }
 *
 * Header Stuff (ignore, just don't conflict with these classes)
 *   - .head for the header
 *   - .copyright for the copyright
 *
 * Miscellaneous
 *   - .overlarge for things that should be as wide as possible, even if
 *     that overflows the body text area. This can be used on an item or
 *     on its container, depending on the effect desired.
 *     Note that this styling basically doesn't help at all when printing,
 *     since A4 paper isn't much wider than the max-width here.
 *     It's better to design things to fit into a narrower measure if possible.
 *   - js-added ToC jump links (see fixup.js)
 *
 ******************************************************************************/

/******************************************************************************/
/*                                   Body                                     */
/******************************************************************************/

	body {
		counter-reset: example figure issue;

		/* Layout */
		max-width: 50em;               /* limit line length to 50em for readability   */
		margin: 0 auto;                /* center text within page                     */
		padding: 1.6em 1.5em 2em 50px; /* assume 16px font size for downlevel clients */
		padding: 1.6em 1.5em 2em calc(26px + 1.5em); /* leave space for status flag     */

		/* Typography */
		line-height: 1.5;
		font-family: sans-serif;
		widows: 2;
		orphans: 2;
		word-wrap: break-word;
		overflow-wrap: break-word;
		hyphens: auto;

		/* Colors */
		color: black;
		background: white top left fixed no-repeat;
		background-size: 25px auto;
	}


/******************************************************************************/
/*                         Front Matter & Navigation                          */
/******************************************************************************/

/** Header ********************************************************************/

	div.head { margin-bottom: 1em }
	div.head hr { border-style: solid; }

	div.head h1 {
		font-weight: bold;
		margin: 0 0 .1em;
		font-size: 220%;
	}

	div.head h2 { margin-bottom: 1.5em;}

/** W3C Logo ******************************************************************/

	.head .logo {
		float: right;
		margin: 0.4rem 0 0.2rem .4rem;
	}

	.head img[src*="logos/W3C"] {
		display: block;
		border: solid #1a5e9a;
		border-width: .65rem .7rem .6rem;
		border-radius: .4rem;
		background: #1a5e9a;
		color: white;
		font-weight: bold;
	}

	.head a:hover > img[src*="logos/W3C"],
	.head a:focus > img[src*="logos/W3C"] {
		opacity: .8;
	}

	.head a:active > img[src*="logos/W3C"] {
		background: #c00;
		border-color: #c00;
	}

	/* see also additional rules in Link Styling section */

/** Copyright *****************************************************************/

	p.copyright,
	p.copyright small { font-size: small }

/** Back to Top / ToC Toggle **************************************************/

	@media print {
		#toc-nav {
			display: none;
		}
	}
	@media not print {
		#toc-nav {
			position: fixed;
			z-index: 2;
			bottom: 0; left: 0;
			margin: 0;
			min-width: 1.33em;
			border-top-right-radius: 2rem;
			box-shadow: 0 0 2px;
			font-size: 1.5em;
			color: black;
		}
		#toc-nav > a {
			display: block;
			white-space: nowrap;

			height: 1.33em;
			padding: .1em 0.3em;
			margin: 0;

			background: white;
			box-shadow: 0 0 2px;
			border: none;
			border-top-right-radius: 1.33em;
			background: white;
		}
		#toc-nav > #toc-jump {
			padding-bottom: 2em;
			margin-bottom: -1.9em;
		}

		#toc-nav > a:hover,
		#toc-nav > a:focus {
			background: #f8f8f8;
		}
		#toc-nav > a:not(:hover):not(:focus) {
			color: #707070;
		}

		/* statusbar gets in the way on keyboard focus; remove once browsers fix */
		#toc-nav > a[href="#toc"]:not(:hover):focus:last-child {
			padding-bottom: 1.5rem;
		}

		#toc-nav:not(:hover) > a:not(:focus) > span + span {
			/* Ideally this uses :focus-within on #toc-nav */
			display: none;
		}
		#toc-nav > a > span + span {
			padding-right: 0.2em;
		}

		#toc-toggle-inline {
			vertical-align: 0.05em;
			font-size: 80%;
			color: gray;
			color: hsla(203,20%,40%,.7);
			border-style: none;
			background: transparent;
			position: relative;
		}
		#toc-toggle-inline:hover:not(:active),
		#toc-toggle-inline:focus:not(:active) {
			text-shadow: 1px 1px silver;
			top: -1px;
			left: -1px;
		}

		#toc-nav :active {
			color: #C00;
		}
	}

/** ToC Sidebar ***************************************************************/

	/* Floating sidebar */
	@media screen {
		body.toc-sidebar #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			max-width: 80%;
			max-width: calc(100% - 2em - 26px);
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			background: inherit;
			background-color: #f7f8f9;
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
		}
		body.toc-sidebar #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
		}
		body.toc-sidebar #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	/* Hide main scroller when only the ToC is visible anyway */
	@media screen and (max-width: 28em) {
		body.toc-sidebar {
			overflow: hidden;
		}
	}

	/* Sidebar with its own space */
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			background: inherit;
			background-color: #f7f8f9;
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
		}
		body:not(.toc-inline) #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
		}

		body:not(.toc-inline) {
			padding-left: 29em;
		}
		/* See also Overflow section at the bottom */

		body:not(.toc-inline) #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) {
			margin: 0 4em;
		}
	}

/******************************************************************************/
/*                                Sectioning                                  */
/******************************************************************************/

/** Headings ******************************************************************/

	h1, h2, h3, h4, h5, h6, dt {
		page-break-after: avoid;
		page-break-inside: avoid;
		font: 100% sans-serif;   /* Reset all font styling to clear out UA styles */
		font-family: inherit;    /* Inherit the font family. */
		line-height: 1.2;        /* Keep wrapped headings compact */
		hyphens: manual;         /* Hyphenated headings look weird */
	}

	h2, h3, h4, h5, h6 {
		margin-top: 3rem;
	}

	h1, h2, h3 {
		color: #005A9C;
		background: transparent;
	}

	h1 { font-size: 170%; }
	h2 { font-size: 140%; }
	h3 { font-size: 120%; }
	h4 { font-weight: bold; }
	h5 { font-style: italic; }
	h6 { font-variant: small-caps; }
	dt { font-weight: bold; }

/** Subheadings ***************************************************************/

	h1 + h2,
	#subtitle {
		/* #subtitle is a subtitle in an H2 under the H1 */
		margin-top: 0;
	}
	h2 + h3,
	h3 + h4,
	h4 + h5,
	h5 + h6 {
		margin-top: 1.2em; /* = 1 x line-height */
	}

/** Section divider ***********************************************************/

	:not(.head) > hr {
		font-size: 1.5em;
		text-align: center;
		margin: 1em auto;
		height: auto;
		border: transparent solid 0;
		background: transparent;
	}
	:not(.head) > hr::before {
		content: "\2727\2003\2003\2727\2003\2003\2727";
	}

/******************************************************************************/
/*                            Paragraphs and Lists                            */
/******************************************************************************/

	p {
		margin: 1em 0;
	}

	dd > p:first-child,
	li > p:first-child {
		margin-top: 0;
	}

	ul, ol {
		margin-left: 0;
		padding-left: 2em;
	}

	li {
		margin: 0.25em 0 0.5em;
		padding: 0;
	}

	dl dd {
		margin: 0 0 .5em 2em;
	}

	.head dd + dd { /* compact for header */
		margin-top: -.5em;
	}

	/* Style for algorithms */
	ol.algorithm ol:not(.algorithm),
	.algorithm > ol ol:not(.algorithm) {
	 border-left: 0.5em solid #DEF;
	}

	/* Put nice boxes around each algorithm. */
	[data-algorithm]:not(.heading) {
	  padding: .5em;
	  border: thin solid #ddd; border-radius: .5em;
	  margin: .5em 0;
	}
	[data-algorithm]:not(.heading) > :first-child {
	  margin-top: 0;
	}
	[data-algorithm]:not(.heading) > :last-child {
	  margin-bottom: 0;
	}

	/* Style for switch/case <dl>s */
	dl.switch > dd > ol.only,
	dl.switch > dd > .only > ol {
	 margin-left: 0;
	}
	dl.switch > dd > ol.algorithm,
	dl.switch > dd > .algorithm > ol {
	 margin-left: -2em;
	}
	dl.switch {
	 padding-left: 2em;
	}
	dl.switch > dt {
	 text-indent: -1.5em;
	 margin-top: 1em;
	}
	dl.switch > dt + dt {
	 margin-top: 0;
	}
	dl.switch > dt::before {
	 content: '\21AA';
	 padding: 0 0.5em 0 0;
	 display: inline-block;
	 width: 1em;
	 text-align: right;
	 line-height: 0.5em;
	}

/** Terminology Markup ********************************************************/


/******************************************************************************/
/*                                 Inline Markup                              */
/******************************************************************************/

/** Terminology Markup ********************************************************/
	dfn   { /* Defining instance */
		font-weight: bolder;
	}
	a > i { /* Instance of term */
		font-style: normal;
	}
	dt dfn code, code.idl {
		font-size: normal;
	}
	dfn var {
		font-style: normal;
	}

/** Change Marking ************************************************************/

	del { color: red;  text-decoration: line-through; }
	ins { color: #080; text-decoration: underline;    }

/** Miscellaneous improvements to inline formatting ***************************/

	sup {
		vertical-align: super;
		font-size: 80%
	}

/******************************************************************************/
/*                                    Code                                    */
/******************************************************************************/

/** General monospace/pre rules ***********************************************/

	pre, code, samp {
		font-family: Menlo, Consolas, "DejaVu Sans Mono", Monaco, monospace;
		font-size: .9em;
		page-break-inside: avoid;
		hyphens: none;
		text-transform: none;
	}
	pre code,
	code code {
		font-size: 100%;
	}

	pre {
		margin-top: 1em;
		margin-bottom: 1em;
		overflow: auto;
	}

/** Inline Code fragments *****************************************************/

  /* Do something nice. */

/******************************************************************************/
/*                                    Links                                   */
/******************************************************************************/

/** General Hyperlinks ********************************************************/

	/* We hyperlink a lot, so make it less intrusive */
	a[href] {
		color: #034575;
		text-decoration: none;
		border-bottom: 1px solid #707070;
		/* Need a bit of extending for it to look okay */
		padding: 0 1px 0;
		margin: 0 -1px 0;
	}
	a:visited {
		border-bottom-color: #BBB;
	}

	/* Use distinguishing colors when user is interacting with the link */
	a[href]:focus,
	a[href]:hover {
		background: #f8f8f8;
		background: rgba(75%, 75%, 75%, .25);
		border-bottom-width: 3px;
		margin-bottom: -2px;
	}
	a[href]:active {
		color: #C00;
		border-color: #C00;
	}

	/* Backout above styling for W3C logo */
	.head .logo,
	.head .logo a {
		border: none;
		text-decoration: none;
		background: transparent;
	}

/******************************************************************************/
/*                                    Images                                  */
/******************************************************************************/

	img {
		border-style: none;
	}

	/* For autogen numbers, add
	   .caption::before, figcaption::before { content: "Figure " counter(figure) ". "; }
	*/

	figure, .figure, .sidefigure {
		page-break-inside: avoid;
		text-align: center;
		margin: 2.5em 0;
	}
	.figure img,    .sidefigure img,    figure img,
	.figure object, .sidefigure object, figure object {
		max-width: 100%;
		margin: auto;
	}
	.figure pre, .sidefigure pre, figure pre {
		text-align: left;
		display: table;
		margin: 1em auto;
	}
	.figure table, figure table {
		margin: auto;
	}
	@media screen and (min-width: 20em) {
		.sidefigure {
			float: right;
			width: 50%;
			margin: 0 0 0.5em 0.5em
		}
	}
	.caption, figcaption, caption {
		font-style: italic;
		font-size: 90%;
	}
	.caption::before, figcaption::before, figcaption > .marker {
		font-weight: bold;
	}
	.caption, figcaption {
		counter-increment: figure;
	}

	/* DL list is indented 2em, but figure inside it is not */
	dd > .figure, dd > figure { margin-left: -2em }

/******************************************************************************/
/*                             Colored Boxes                                  */
/******************************************************************************/

	.issue, .note, .example, .assertion, .advisement, blockquote {
		padding: .5em;
		border: .5em;
		border-left-style: solid;
		page-break-inside: avoid;
	}
	span.issue, span.note {
		padding: .1em .5em .15em;
		border-right-style: solid;
	}

	.issue,
	.note,
	.example,
	.advisement,
	.assertion,
	blockquote {
		margin: 1em auto;
	}
	.note  > p:first-child,
	.issue > p:first-child,
	blockquote > :first-child {
		margin-top: 0;
	}
	blockquote > :last-child {
		margin-bottom: 0;
	}

/** Blockquotes ***************************************************************/

	blockquote {
		border-color: silver;
	}

/** Open issue ****************************************************************/

	.issue {
		border-color: #E05252;
		background: #FBE9E9;
		counter-increment: issue;
		overflow: auto;
	}
	.issue::before, .issue > .marker {
		text-transform: uppercase;
		color: #AE1E1E;
		padding-right: 1em;
		text-transform: uppercase;
	}
	/* Add .issue::before { content: "Issue " counter(issue) " "; } for autogen numbers,
	   or use class="marker" to mark up the issue number in source. */

/** Example *******************************************************************/

	.example {
		border-color: #E0CB52;
		background: #FCFAEE;
		counter-increment: example;
		overflow: auto;
		clear: both;
	}
	.example::before, .example > .marker {
		text-transform: uppercase;
		color: #827017;
		min-width: 7.5em;
		display: block;
	}
	/* Add .example::before { content: "Example " counter(example) " "; } for autogen numbers,
	   or use class="marker" to mark up the example number in source. */

/** Non-normative Note ********************************************************/

	.note {
		border-color: #52E052;
		background: #E9FBE9;
		overflow: auto;
	}

	.note::before, .note > .marker,
	details.note > summary::before,
	details.note > summary > .marker {
		text-transform: uppercase;
		display: block;
		color: hsl(120, 70%, 30%);
	}
	/* Add .note::before { content: "Note"; } for autogen label,
	   or use class="marker" to mark up the label in source. */

	details.note > summary {
		display: block;
		color: hsl(120, 70%, 30%);
	}
	details.note[open] > summary {
		border-bottom: 1px silver solid;
	}

/** Assertion Box *************************************************************/
	/*  for assertions in algorithms */

	.assertion {
		border-color: #AAA;
		background: #EEE;
	}

/** Advisement Box ************************************************************/
	/*  for attention-grabbing normative statements */

	.advisement {
		border-color: orange;
		border-style: none solid;
		background: #FFEECC;
	}
	strong.advisement {
		display: block;
		text-align: center;
	}
	.advisement > .marker {
		color: #B35F00;
	}

/** Spec Obsoletion Notice ****************************************************/
	/* obnoxious obsoletion notice for older/abandoned specs. */

	details {
		display: block;
	}
	summary {
		font-weight: bolder;
	}

	.annoying-warning:not(details),
	details.annoying-warning:not([open]) > summary,
	details.annoying-warning[open] {
		background: #fdd;
		color: red;
		font-weight: bold;
		padding: .75em 1em;
		border: thick red;
		border-style: solid;
		border-radius: 1em;
	}
	.annoying-warning :last-child {
		margin-bottom: 0;
	}

@media not print {
	details.annoying-warning[open] {
		position: fixed;
		left: 1em;
		right: 1em;
		bottom: 1em;
		z-index: 1000;
	}
}

	details.annoying-warning:not([open]) > summary {
		text-align: center;
	}

/** Entity Definition Boxes ***************************************************/

	.def {
		padding: .5em 1em;
		background: #DEF;
		margin: 1.2em 0;
		border-left: 0.5em solid #8CCBF2;
	}

/******************************************************************************/
/*                                    Tables                                  */
/******************************************************************************/

	th, td {
		text-align: left;
		text-align: start;
	}

/** Property/Descriptor Definition Tables *************************************/

	table.def {
		/* inherits .def box styling, see above */
		width: 100%;
		border-spacing: 0;
	}

	table.def td,
	table.def th {
		padding: 0.5em;
		vertical-align: baseline;
		border-bottom: 1px solid #bbd7e9;
	}

	table.def > tbody > tr:last-child th,
	table.def > tbody > tr:last-child td {
		border-bottom: 0;
	}

	table.def th {
		font-style: italic;
		font-weight: normal;
		padding-left: 1em;
		width: 3em;
	}

	/* For when values are extra-complex and need formatting for readability */
	table td.pre {
		white-space: pre-wrap;
	}

	/* A footnote at the bottom of a def table */
	table.def           td.footnote {
		padding-top: 0.6em;
	}
	table.def           td.footnote::before {
		content: " ";
		display: block;
		height: 0.6em;
		width: 4em;
		border-top: thin solid;
	}

/** Data tables (and properly marked-up index tables) *************************/
	/*
		 <table class="data"> highlights structural relationships in a table
		 when correct markup is used (e.g. thead/tbody, th vs. td, scope attribute)

		 Use class="complex data" for particularly complicated tables --
		 (This will draw more lines: busier, but clearer.)

		 Use class="long" on table cells with paragraph-like contents
		 (This will adjust text alignment accordingly.)
		 Alternately use class="longlastcol" on tables, to have the last column assume "long".
	*/

	table {
		word-wrap: normal;
		overflow-wrap: normal;
		hyphens: manual;
	}

	table.data,
	table.index {
		margin: 1em auto;
		border-collapse: collapse;
		border: hidden;
		width: 100%;
	}
	table.data caption,
	table.index caption {
		max-width: 50em;
		margin: 0 auto 1em;
	}

	table.data td,  table.data th,
	table.index td, table.index th {
		padding: 0.5em 1em;
		border-width: 1px;
		border-color: silver;
		border-top-style: solid;
	}

	table.data thead td:empty {
		padding: 0;
		border: 0;
	}

	table.data  thead,
	table.index thead,
	table.data  tbody,
	table.index tbody {
		border-bottom: 2px solid;
	}

	table.data colgroup,
	table.index colgroup {
		border-left: 2px solid;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		border-right: 2px solid;
		border-top: 1px solid silver;
		padding-right: 1em;
	}

	table.data th[colspan],
	table.data td[colspan] {
		text-align: center;
	}

	table.complex.data th,
	table.complex.data td {
		border: 1px solid silver;
		text-align: center;
	}

	table.data.longlastcol td:last-child,
	table.data td.long {
	 vertical-align: baseline;
	 text-align: left;
	}

	table.data img {
		vertical-align: middle;
	}


/*
Alternate table alignment rules

	table.data,
	table.index {
		text-align: center;
	}

	table.data  thead th[scope="row"],
	table.index thead th[scope="row"] {
		text-align: right;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		text-align: right;
	}

Possible extra rowspan handling

	table.data  tbody th[rowspan]:not([rowspan='1']),
	table.index tbody th[rowspan]:not([rowspan='1']),
	table.data  tbody td[rowspan]:not([rowspan='1']),
	table.index tbody td[rowspan]:not([rowspan='1']) {
		border-left: 1px solid silver;
	}

	table.data  tbody th[rowspan]:first-child,
	table.index tbody th[rowspan]:first-child,
	table.data  tbody td[rowspan]:first-child,
	table.index tbody td[rowspan]:first-child{
		border-left: 0;
		border-right: 1px solid silver;
	}
*/

/******************************************************************************/
/*                                  Indices                                   */
/******************************************************************************/


/** Table of Contents *********************************************************/

	.toc a {
		/* More spacing; use padding to make it part of the click target. */
		padding-top: 0.1rem;
		/* Larger, more consistently-sized click target */
		display: block;
		/* Reverse color scheme */
		color: black;
		border-color: #3980B5;
	}
	.toc a:visited {
		border-color: #054572;
	}
	.toc a:not(:focus):not(:hover) {
		/* Allow colors to cascade through from link styling */
		border-bottom-color: transparent;
	}

	.toc, .toc ol, .toc ul, .toc li {
		list-style: none; /* Numbers must be inlined into source */
		/* because generated content isn't search/selectable and markers can't do multilevel yet */
		margin:  0;
		padding: 0;
		line-height: 1.1rem; /* consistent spacing */
	}

	/* ToC not indented until third level, but font style & margins show hierarchy */
	.toc > li             { font-weight: bold;   }
	.toc > li li          { font-weight: normal; }
	.toc > li li li       { font-size:   95%;    }
	.toc > li li li li    { font-size:   90%;    }
	.toc > li li li li li { font-size:   85%;    }

	.toc > li             { margin: 1.5rem 0;    }
	.toc > li li          { margin: 0.3rem 0;    }
	.toc > li li li       { margin-left: 2rem;   }

	/* Section numbers in a column of their own */
	.toc .secno {
		float: left;
		width: 4rem;
		white-space: nowrap;
	}
	.toc > li li li li .secno {
		font-size: 85%;
	}
	.toc > li li li li li .secno {
		font-size: 100%;
	}

	:not(li) > .toc              { margin-left:  5rem; }
	.toc .secno                  { margin-left: -5rem; }
	.toc > li li li .secno       { margin-left: -7rem; }
	.toc > li li li li .secno    { margin-left: -9rem; }
	.toc > li li li li li .secno { margin-left: -11rem; }

	/* Tighten up indentation in narrow ToCs */
	@media (max-width: 30em) {
		:not(li) > .toc              { margin-left:  4rem; }
		.toc .secno                  { margin-left: -4rem; }
		.toc > li li li              { margin-left:  1rem; }
		.toc > li li li .secno       { margin-left: -5rem; }
		.toc > li li li li .secno    { margin-left: -6rem; }
		.toc > li li li li li .secno { margin-left: -7rem; }
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) :not(li) > .toc              { margin-left:  4rem; }
		body:not(.toc-inline) .toc .secno                  { margin-left: -4rem; }
		body:not(.toc-inline) .toc > li li li              { margin-left:  1rem; }
		body:not(.toc-inline) .toc > li li li .secno       { margin-left: -5rem; }
		body:not(.toc-inline) .toc > li li li li .secno    { margin-left: -6rem; }
		body:not(.toc-inline) .toc > li li li li li .secno { margin-left: -7rem; }
	}
	body.toc-sidebar #toc :not(li) > .toc              { margin-left:  4rem; }
	body.toc-sidebar #toc .toc .secno                  { margin-left: -4rem; }
	body.toc-sidebar #toc .toc > li li li              { margin-left:  1rem; }
	body.toc-sidebar #toc .toc > li li li .secno       { margin-left: -5rem; }
	body.toc-sidebar #toc .toc > li li li li .secno    { margin-left: -6rem; }
	body.toc-sidebar #toc .toc > li li li li li .secno { margin-left: -7rem; }

	.toc li {
		clear: both;
	}


/** Index *********************************************************************/

	/* Index Lists: Layout */
	ul.index       { margin-left: 0; columns: 15em; text-indent: 1em hanging; }
	ul.index li    { margin-left: 0; list-style: none; break-inside: avoid; }
	ul.index li li { margin-left: 1em }
	ul.index dl    { margin-top: 0; }
	ul.index dt    { margin: .2em 0 .2em 20px;}
	ul.index dd    { margin: .2em 0 .2em 40px;}
	/* Index Lists: Typography */
	ul.index ul,
	ul.index dl { font-size: smaller; }
	@media not print {
		ul.index li span {
			white-space: nowrap;
			color: transparent; }
		ul.index li a:hover + span,
		ul.index li a:focus + span {
			color: #707070;
		}
	}

/** Index Tables *****************************************************/
	/* See also the data table styling section, which this effectively subclasses */

	table.index {
		font-size: small;
		border-collapse: collapse;
		border-spacing: 0;
		text-align: left;
		margin: 1em 0;
	}

	table.index td,
	table.index th {
		padding: 0.4em;
	}

	table.index tr:hover td:not([rowspan]),
	table.index tr:hover th:not([rowspan]) {
		background: #f7f8f9;
	}

	/* The link in the first column in the property table (formerly a TD) */
	table.index th:first-child a {
		font-weight: bold;
	}

/******************************************************************************/
/*                                    Print                                   */
/******************************************************************************/

	@media print {
		/* Pages have their own margins. */
		html {
			margin: 0;
		}
		/* Serif for print. */
		body {
			font-family: serif;
		}
	}
	@page {
		margin: 1.5cm 1.1cm;
	}

/******************************************************************************/
/*                                    Legacy                                  */
/******************************************************************************/

	/* This rule is inherited from past style sheets. No idea what it's for. */
	.hide { display: none }



/******************************************************************************/
/*                             Overflow Control                               */
/******************************************************************************/

	.figure .caption, .sidefigure .caption, figcaption {
		/* in case figure is overlarge, limit caption to 50em */
		max-width: 50rem;
		margin-left: auto;
		margin-right: auto;
	}
	.overlarge > table {
		/* limit preferred width of table */
		max-width: 50em;
		margin-left: auto;
		margin-right: auto;
	}

	@media (min-width: 55em) {
		.overlarge {
			margin-left: calc(13px + 26.5rem - 50vw);
			margin-right: calc(13px + 26.5rem - 50vw);
			max-width: none;
		}
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) .overlarge {
			/* 30.5em body padding 50em content area */
			margin-left: calc(40em - 50vw) !important;
			margin-right: calc(40em - 50vw) !important;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) .overlarge {
			/* 4em html margin 30.5em body padding 50em content area */
			margin-left: 0 !important;
			margin-right: calc(84.5em - 100vw) !important;
		}
	}

	@media not print {
		.overlarge {
			overflow-x: auto;
			/* See Lea Verou's explanation background-attachment:
			 * http://lea.verou.me/2012/04/background-attachment-local/
			 *
			background: top left  / 4em 100% linear-gradient(to right,  #ffffff, rgba(255, 255, 255, 0)) local,
			            top right / 4em 100% linear-gradient(to left, #ffffff, rgba(255, 255, 255, 0)) local,
			            top left  / 1em 100% linear-gradient(to right,  #c3c3c5, rgba(195, 195, 197, 0)) scroll,
			            top right / 1em 100% linear-gradient(to left, #c3c3c5, rgba(195, 195, 197, 0)) scroll,
			            white;
			background-repeat: no-repeat;
			*/
		}
	}
</style>
  <meta content="Bikeshed 1.0.0" name="generator">
<style>/* style-md-lists */

            /* This is a weird hack for me not yet following the commonmark spec
               regarding paragraph and lists. */
            [data-md] > :first-child {
                margin-top: 0;
            }
            [data-md] > :last-child {
                margin-bottom: 0;
            }</style>
<style>/* style-counters */

            body {
                counter-reset: example figure issue;
            }
            .issue {
                counter-increment: issue;
            }
            .issue:not(.no-marker)::before {
                content: "Issue " counter(issue);
            }

            .example {
                counter-increment: example;
            }
            .example:not(.no-marker)::before {
                content: "Example " counter(example);
            }
            .invalid.example:not(.no-marker)::before,
            .illegal.example:not(.no-marker)::before {
                content: "Invalid Example" counter(example);
            }

            figcaption {
                counter-increment: figure;
            }
            figcaption:not(.no-marker)::before {
                content: "Figure " counter(figure) " ";
            }</style>
<style>/* style-syntax-highlighting */

        .highlight:not(.idl) { background: hsl(24, 20%, 95%); }
        code.highlight { padding: .1em; border-radius: .3em; }
        pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }
        .highlight .c { color: #708090 } /* Comment */
        .highlight .k { color: #990055 } /* Keyword */
        .highlight .l { color: #000000 } /* Literal */
        .highlight .n { color: #0077aa } /* Name */
        .highlight .o { color: #999999 } /* Operator */
        .highlight .p { color: #999999 } /* Punctuation */
        .highlight .cm { color: #708090 } /* Comment.Multiline */
        .highlight .cp { color: #708090 } /* Comment.Preproc */
        .highlight .c1 { color: #708090 } /* Comment.Single */
        .highlight .cs { color: #708090 } /* Comment.Special */
        .highlight .kc { color: #990055 } /* Keyword.Constant */
        .highlight .kd { color: #990055 } /* Keyword.Declaration */
        .highlight .kn { color: #990055 } /* Keyword.Namespace */
        .highlight .kp { color: #990055 } /* Keyword.Pseudo */
        .highlight .kr { color: #990055 } /* Keyword.Reserved */
        .highlight .kt { color: #990055 } /* Keyword.Type */
        .highlight .ld { color: #000000 } /* Literal.Date */
        .highlight .m { color: #000000 } /* Literal.Number */
        .highlight .s { color: #a67f59 } /* Literal.String */
        .highlight .na { color: #0077aa } /* Name.Attribute */
        .highlight .nc { color: #0077aa } /* Name.Class */
        .highlight .no { color: #0077aa } /* Name.Constant */
        .highlight .nd { color: #0077aa } /* Name.Decorator */
        .highlight .ni { color: #0077aa } /* Name.Entity */
        .highlight .ne { color: #0077aa } /* Name.Exception */
        .highlight .nf { color: #0077aa } /* Name.Function */
        .highlight .nl { color: #0077aa } /* Name.Label */
        .highlight .nn { color: #0077aa } /* Name.Namespace */
        .highlight .py { color: #0077aa } /* Name.Property */
        .highlight .nt { color: #669900 } /* Name.Tag */
        .highlight .nv { color: #222222 } /* Name.Variable */
        .highlight .ow { color: #999999 } /* Operator.Word */
        .highlight .mb { color: #000000 } /* Literal.Number.Bin */
        .highlight .mf { color: #000000 } /* Literal.Number.Float */
        .highlight .mh { color: #000000 } /* Literal.Number.Hex */
        .highlight .mi { color: #000000 } /* Literal.Number.Integer */
        .highlight .mo { color: #000000 } /* Literal.Number.Oct */
        .highlight .sb { color: #a67f59 } /* Literal.String.Backtick */
        .highlight .sc { color: #a67f59 } /* Literal.String.Char */
        .highlight .sd { color: #a67f59 } /* Literal.String.Doc */
        .highlight .s2 { color: #a67f59 } /* Literal.String.Double */
        .highlight .se { color: #a67f59 } /* Literal.String.Escape */
        .highlight .sh { color: #a67f59 } /* Literal.String.Heredoc */
        .highlight .si { color: #a67f59 } /* Literal.String.Interpol */
        .highlight .sx { color: #a67f59 } /* Literal.String.Other */
        .highlight .sr { color: #a67f59 } /* Literal.String.Regex */
        .highlight .s1 { color: #a67f59 } /* Literal.String.Single */
        .highlight .ss { color: #a67f59 } /* Literal.String.Symbol */
        .highlight .vc { color: #0077aa } /* Name.Variable.Class */
        .highlight .vg { color: #0077aa } /* Name.Variable.Global */
        .highlight .vi { color: #0077aa } /* Name.Variable.Instance */
        .highlight .il { color: #000000 } /* Literal.Number.Integer.Long */
        </style>
<style>/* style-selflinks */

            .heading, .issue, .note, .example, li, dt {
                position: relative;
            }
            a.self-link {
                position: absolute;
                top: 0;
                left: calc(-1 * (3.5rem - 26px));
                width: calc(3.5rem - 26px);
                height: 2em;
                text-align: center;
                border: none;
                transition: opacity .2s;
                opacity: .5;
            }
            a.self-link:hover {
                opacity: 1;
            }
            .heading > a.self-link {
                font-size: 83%;
            }
            li > a.self-link {
                left: calc(-1 * (3.5rem - 26px) - 2em);
            }
            dfn > a.self-link {
                top: auto;
                left: auto;
                opacity: 0;
                width: 1.5em;
                height: 1.5em;
                background: gray;
                color: white;
                font-style: normal;
                transition: opacity .2s, background-color .2s, color .2s;
            }
            dfn:hover > a.self-link {
                opacity: 1;
            }
            dfn > a.self-link:hover {
                color: black;
            }

            a.self-link::before            { content: "Â¶"; }
            .heading > a.self-link::before { content: "Â§"; }
            dfn > a.self-link::before      { content: "#"; }</style>
<style>/* style-autolinks */

            .css.css, .property.property, .descriptor.descriptor {
                color: #005a9c;
                font-size: inherit;
                font-family: inherit;
            }
            .css::before, .property::before, .descriptor::before {
                content: "â";
            }
            .css::after, .property::after, .descriptor::after {
                content: "â";
            }
            .property, .descriptor {
                /* Don't wrap property and descriptor names */
                white-space: nowrap;
            }
            .type { /* CSS value <type> */
                font-style: italic;
            }
            pre .property::before, pre .property::after {
                content: "";
            }
            [data-link-type="property"]::before,
            [data-link-type="propdesc"]::before,
            [data-link-type="descriptor"]::before,
            [data-link-type="value"]::before,
            [data-link-type="function"]::before,
            [data-link-type="at-rule"]::before,
            [data-link-type="selector"]::before,
            [data-link-type="maybe"]::before {
                content: "â";
            }
            [data-link-type="property"]::after,
            [data-link-type="propdesc"]::after,
            [data-link-type="descriptor"]::after,
            [data-link-type="value"]::after,
            [data-link-type="function"]::after,
            [data-link-type="at-rule"]::after,
            [data-link-type="selector"]::after,
            [data-link-type="maybe"]::after {
                content: "â";
            }

            [data-link-type].production::before,
            [data-link-type].production::after,
            .prod [data-link-type]::before,
            .prod [data-link-type]::after {
                content: "";
            }

            [data-link-type=element],
            [data-link-type=element-attr] {
                font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
                font-size: .9em;
            }
            [data-link-type=element]::before { content: "<" }
            [data-link-type=element]::after  { content: ">" }

            [data-link-type=biblio] {
                white-space: pre;
            }</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"></p>
   <h1 class="p-name no-ref" id="title">p0461r0<br>Proposed RCU C++ API</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">Published Proposal, <time class="dt-updated" datetime="2016-11-11">11 November 2016</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="http://wg21.link/p0461r0">http://wg21.link/p0461r0</a>
     <dt>Issue Tracking:
     <dd><a href="#issues-index">Inline In Spec</a>
     <dt>Authors:
     <dd>
      <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:paulmck@linux.vnet.ibm.com">Paul E. McKenney</a> (<span class="p-org org">IBM</span>)
     <dd>
      <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:dshollm@sandia.gov">David S. Hollman</a> (<span class="p-org org">Sandia National Labs</span>)
     <dd>
      <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:isabella.muerte@mnmlstc.com">Isabella Muerte</a>
     <dd>
      <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:arthur.j.odwyer@gmail.com">Arthur O'Dwyer</a>
     <dd>
      <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:maged.michael@gmail.com">Maged Michael</a> (<span class="p-org org">Facebook</span>)
     <dd>
      <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:michael@codeplay.com">Michael Wong</a> (<span class="p-org org">Codeplay</span>)
     <dd>
      <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:jliffla@sandia.gov">Jonathan Lifflander</a> (<span class="p-org org">Sandia National Labs</span>)
     <dt>Audience:
     <dd>SG1
     <dt>Project:
     <dd><span>ISO JTC1/SC22/WG21: Programming Language C++</span>
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <hr title="Separator for header">
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
  <div class="p-summary" data-fill-with="abstract">
   <p>This document is based on <a data-link-type="biblio" href="#biblio-p0279r1">[P0279R1]</a> combined with feedback at

the 2015 Kona and 2016 Jacksonville meetings, which most notably called
for a C++-style method of handling different RCU implementations or
domains within a single translation unit, and which also contains
useful background material and references.
Unlike <a data-link-type="biblio" href="#biblio-p0279r1">[P0279R1]</a>, which simply introduced RCUâs C-language practice,
this document presents proposals for C++-style RCU APIs.
At present, it appears that these are not conflicting proposals, but
rather ways of handling different C++ use cases resulting from
inheritance, templates, and different levels of memory pressure.
This document also incorporates content from <a data-link-type="biblio" href="#biblio-p0232r0">[P0232R0]</a></p>
   <p>Note that this proposal is related to the hazard-pointer proposal in

that both proposals defer destructive actions such as reclamation until
all readers have completed.</p>
   <p>Note also that a redefinition of the infamous `memory_order_consume`

is the subject of a separate paper.</p>
  </div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#introduction"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li>
     <a href="#base-rcu-api"><span class="secno">2</span> <span class="content">Base RCU API</span></a>
     <ol class="toc">
      <li><a href="#rcu-domains"><span class="secno">2.1</span> <span class="content">RCU Domains</span></a>
      <li><a href="#run-time-domain-selection"><span class="secno">2.2</span> <span class="content">Run-Time Domain Selection</span></a>
     </ol>
    <li><a href="#scoped-readers"><span class="secno">3</span> <span class="content">Scoped Readers</span></a>
    <li>
     <a href="#rcu-callback-handling"><span class="secno">4</span> <span class="content">RCU Callback Handling</span></a>
     <ol class="toc">
      <li><a href="#derived-function-call"><span class="secno">4.1</span> <span class="content">Derived Function Call</span></a>
      <li><a href="#derived-deletion"><span class="secno">4.2</span> <span class="content">Derived Deletion</span></a>
      <li><a href="#pointer-to-enclosing-class"><span class="secno">4.3</span> <span class="content">Pointer To Enclosing Class</span></a>
      <li><a href="#address-arithmetic"><span class="secno">4.4</span> <span class="content">Address Arithmetic</span></a>
     </ol>
    <li><a href="#hazard-pointers-and-rcu"><span class="secno">5</span> <span class="content">Hazard Pointers and RCU: Which to Use?</span></a>
    <li><a href="#summary"><span class="secno">6</span> <span class="content">Summary</span></a>
    <li><a href="#acknowledgments"><span class="secno">7</span> <span class="content">Acknowledgments</span></a>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="introduction"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#introduction"></a></h2>
   <p>This document proposes C++ APIs for read-copy update (RCU).
For more information on RCU, including RCU semantics, see <a data-link-type="biblio" href="#biblio-p0462r0">[P0462R0]</a> ("Marking <code class="highlight"><span class="n">memory_order_consume</span></code> Dependency Chains"), <a data-link-type="biblio" href="#biblio-p0279r1">[P0279R1]</a> ("Read-Copy Update (RCU) for C++"), <a data-link-type="biblio" href="#biblio-p0190r2">[P0190R2]</a> ("Proposal for New <code class="highlight"><span class="n">memory_order_consume</span></code> Definition"),
and <a data-link-type="biblio" href="#biblio-p0098r1">[P0098R1]</a> ("Towards Implementation and Use of <code class="highlight"><span class="n">memory_order_consume</span></code>").</p>
   <p><a href="#base-rcu-api">Â§2 Base RCU API</a> presents the base (C-style) RCU API, <a href="#scoped-readers">Â§3 Scoped Readers</a> presents a proposal for scoped RCU readers, <a href="#rcu-callback-handling">Â§4 RCU Callback Handling</a> presents proposals for handling of RCU callbacks, <a href="#hazard-pointers-and-rcu">Â§5 Hazard Pointers and RCU: Which to Use?</a> presents a
table comparing reference counting, hazard pointers, and RCU, and finally <a href="#summary">Â§6 Summary</a> presents a summary.</p>
   <h2 class="heading settled" data-level="2" id="base-rcu-api"><span class="secno">2. </span><span class="content">Base RCU API</span><a class="self-link" href="#base-rcu-api"></a></h2>
   <p>The base RCU API as provided by implementations such as
userspace RCU (<a data-link-type="biblio" href="#biblio-mathieudesnoyers2009urcu">[MathieuDesnoyers2009URCU]</a> and <a data-link-type="biblio" href="#biblio-paulmckenney2013lwnurcu">[PaulMcKenney2013LWNURCU]</a>).</p>
<pre class="language-c++ highlight"><span class="kt">void</span> <span class="nf">rcu_read_lock</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">rcu_read_unlock</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">synchronize_rcu</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">call_rcu</span><span class="p">(</span><span class="k">struct</span> <span class="n">rcu_head</span> <span class="o">*</span><span class="n">rhp</span><span class="p">,</span>
              <span class="kt">void</span> <span class="n">cbf</span><span class="p">(</span><span class="n">rcu_head</span> <span class="o">*</span><span class="n">rhp</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">rcu_barrier</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">rcu_register_thread</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">rcu_unregister_thread</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">rcu_quiescent_state</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">rcu_thread_offline</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">rcu_thread_online</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
</pre>
   This API is provided for compatibility with existing practice as
well as to provide the highest performance for fast-path code.
(See <a href="#rcu-domains">Â§2.1 RCU Domains</a> for a proposed API that
permits multiple RCU domains, as requested by several committee members.) 
   <p>Lines 1 and 2 show <code class="highlight"><span class="n">rcu_read_lock</span><span class="p">(</span><span class="p">)</span></code> and <code class="highlight"><span class="n">rcu_read_unlock</span><span class="p">(</span><span class="p">)</span></code>,
which mark the beginning and the end, respectively, of an <em>RCU read-side critical section</em>.
These primitives may be nested, and matching <code class="highlight"><span class="n">rcu_read_lock</span><span class="p">(</span><span class="p">)</span></code> and <code class="highlight"><span class="n">rcu_read_unlock</span><span class="p">(</span><span class="p">)</span></code> calls need not be in the same scope.
(That said, it is good practice to place them in the same scope
in cases where the entire critical section fits comfortably into
one scope.)</p>
   <p>Line 3 shows <code class="highlight"><span class="n">synchronize_rcu</span><span class="p">(</span><span class="p">)</span></code>, which waits for any pre-existing
RCU read-side critical sections to complete.
The period of time that <code class="highlight"><span class="n">synchronize_rcu</span><span class="p">(</span><span class="p">)</span></code> is required to wait is
called a <em>grace period</em>.
Note that a given call to <code class="highlight"><span class="n">synchronize_rcu</span><span class="p">(</span><span class="p">)</span></code> is <em>not</em> required to
wait for critical sections that start later.</p>
   <p>Lines 4 and 5 show <code class="highlight"><span class="n">call_rcu</span><span class="p">(</span><span class="p">)</span></code>, which, after a subsequent grace period
elapses, causes the <code class="highlight"><span class="n">cbf</span><span class="p">(</span><span class="n">rhp</span><span class="p">)</span></code> <em>RCU callback function</em> to be invoked.
Thus, <code class="highlight"><span class="n">call_rcu</span><span class="p">(</span><span class="p">)</span></code> is the asynchronous counterpart to <code class="highlight"><span class="n">synchronize_rcu</span><span class="p">(</span><span class="p">)</span></code>.
In most cases, <code class="highlight"><span class="n">synchronize_rcu</span><span class="p">(</span><span class="p">)</span></code> is easier to use, however, <code class="highlight"><span class="n">call_rcu</span><span class="p">(</span><span class="p">)</span></code> has the benefit of moving the grace-period delay off of the updaterâs
critical path.
Use of <code class="highlight"><span class="n">call_rcu</span><span class="p">(</span><span class="p">)</span></code> is thus critically important for good performance of
update-heavy workloads, as has been repeatedly discovered by any number of
people new to RCU <a data-link-type="biblio" href="#biblio-paulemckenney2015readmostly">[PaulEMcKenney2015ReadMostly]</a>.</p>
   <p>Note that although <code class="highlight"><span class="n">call_rcu</span><span class="p">(</span><span class="p">)</span></code>'s callbacks are guaranteed not to be
invoked too early, there is no guarantee that their execution wonât be
deferred for a considerable time.
This can be a problem if a given program requires that all outstanding
RCU callbacks be invoked before that program terminates.
The <code class="highlight"><span class="n">rcu_barrier</span><span class="p">(</span><span class="p">)</span></code> function shown on line 6 is intended for this
situation.
This function blocks until all callbacks corresponding to previous <code class="highlight"><span class="n">call_rcu</span><span class="p">(</span><span class="p">)</span></code> invocations have been invoked and also until after
those invocations have returned.
Therefore, taking the following steps just before terminating a program
will guarantee that all callbacks have completed:</p>
   <ul>
    <li data-md="">
     <p>Take whatever steps are required to ensure that there are no further invocations of <code class="highlight"><span class="n">call_rcu</span><span class="p">(</span><span class="p">)</span></code>.</p>
    <li data-md="">
     <p>Invoke <code class="highlight"><span class="n">rcu_barrier</span><span class="p">(</span><span class="p">)</span></code>.</p>
   </ul>
   <p>Carrying out this procedure just prior to program termination can be very
helpful for avoiding false positives when using tools such as valgrind.</p>
   <p>Many RCU implementations require that every thread announce itself to
RCU prior to entering the first RCU read-side critical section, and
to announce its departure after exiting the last RCU read-side
critical section.
These tasks are carried out via the <code class="highlight"><span class="n">rcu_register_thread</span><span class="p">(</span><span class="p">)</span></code> and <code class="highlight"><span class="n">rcu_unregister_thread</span><span class="p">(</span><span class="p">)</span></code>, respectively.</p>
   <p>The implementations of RCU that feature the most aggressive implementations of <code class="highlight"><span class="n">rcu_read_lock</span><span class="p">(</span><span class="p">)</span></code> and <code class="highlight"><span class="n">rcu_read_unlock</span><span class="p">(</span><span class="p">)</span></code> require that each thread
periodically pass through a <em>quiescent state</em>, which is announced to RCU
using <code class="highlight"><span class="n">rcu_quiescent_state</span><span class="p">(</span><span class="p">)</span></code>.
A thread in a quiescent state is guaranteed not to be in an RCU
read-side critical section.
Threads can also announce entry into and exit from <em>extended quiescent states</em>, for example, before and after blocking system
calls, using <code class="highlight"><span class="n">rcu_thread_offline</span><span class="p">(</span><span class="p">)</span></code> and <code class="highlight"><span class="n">rcu_thread_online</span><span class="p">(</span><span class="p">)</span></code>.</p>
   <h3 class="heading settled" data-level="2.1" id="rcu-domains"><span class="secno">2.1. </span><span class="content">RCU Domains</span><a class="self-link" href="#rcu-domains"></a></h3>
   <p>The userspace RCU library features several RCU implementations, each
optimized for different use cases.</p>
   <p>The quiescent-state based reclamation (QSBR) implementation is intended
for standalone applications where the developers have full control
over the entire application, and where extreme read-side performance
and scalability is required.
Applications use <code class="highlight"><span class="cp">#</span><span class="cp">include</span> "urcu-qsbr.hpp"</code> to select QSBR and <code class="highlight"><span class="o">-</span><span class="n">lurcu</span> <span class="o">-</span><span class="n">lurcu</span><span class="o">-</span><span class="n">qsbr</span></code> to link to it.
These applications must use <code class="highlight"><span class="n">rcu_register_thread</span><span class="p">(</span><span class="p">)</span></code> and <code class="highlight"><span class="n">rcu_unregister_thread</span><span class="p">(</span><span class="p">)</span></code> to announce the coming and going
of each thread that is to execute <code class="highlight"><span class="n">rcu_read_lock</span><span class="p">(</span><span class="p">)</span></code> and <code class="highlight"><span class="n">rcu_read_unlock</span><span class="p">(</span><span class="p">)</span></code>.
They must also use <code class="highlight"><span class="n">rcu_quiescent_state</span><span class="p">(</span><span class="p">)</span></code>, <code class="highlight"><span class="n">rcu_thread_offline</span><span class="p">(</span><span class="p">)</span></code>,
and <code class="highlight"><span class="n">rcu_thread_online</span><span class="p">(</span><span class="p">)</span></code> to announce quiescent states to RCU.</p>
   <p>The memory-barrier implementation is intended for applications that
can announce threads (again using <code class="highlight"><span class="n">rcu_register_thread</span><span class="p">(</span><span class="p">)</span></code> and <code class="highlight"><span class="n">rcu_unregister_thread</span><span class="p">(</span><span class="p">)</span></code>), but for which announcing quiescent states is
impractical.
Such applications use <code class="highlight"><span class="cp">#</span><span class="cp">include</span> "urcu-mb.hpp"</code> and <code class="highlight"><span class="o">-</span><span class="n">lurcu</span><span class="o">-</span><span class="n">mb</span></code> to select the memory-barrier implementation.
Such applications will incur the overhead of a full memory barrier in
each call to <code class="highlight"><span class="n">rcu_read_lock</span><span class="p">(</span><span class="p">)</span></code> and <code class="highlight"><span class="n">rcu_read_unlock</span><span class="p">(</span><span class="p">)</span></code>.</p>
   <p>The signal-based implementation represents a midpoint between the QSBR
and memory-barrier implementations.
Like the memory-barrier implementation, applications must announce
threads, but need not announce quiescent states.
On the one hand, readers are almost as fast as in the QSBR implementation,
but on the other applications must give up a signal to RCU, by default <code class="highlight"><span class="n">SIGUSR1</span></code>.
Such applications use <code class="highlight"><span class="cp">#</span><span class="cp">include</span> "urcu-signal.hpp"</code> and <code class="highlight"><span class="o">-</span><span class="n">lurcu</span><span class="o">-</span><span class="n">signal</span></code> to select signal-based RCU.</p>
   <p>So-called "bullet-proof RCU" avoids the need to announce either threads
or quiescent states, and is therefore the best choice for use by
libraries that might well be linked with RCU-oblivious applications.
The penalty is that <code class="highlight"><span class="n">rcu_read_lock</span><span class="p">(</span><span class="p">)</span></code> incurs both a memory barrier
and a test and <code class="highlight"><span class="n">rcu_read_unlock</span><span class="p">(</span><span class="p">)</span></code> incurs a memory barrier.
Such applications or libraries use <code class="highlight"><span class="cp">#</span><span class="cp">include</span> urcu-bp.hpp</code> and <code class="highlight"><span class="o">-</span><span class="n">lurcu</span><span class="o">-</span><span class="n">bp</span></code>.</p>
   <h3 class="heading settled" data-level="2.2" id="run-time-domain-selection"><span class="secno">2.2. </span><span class="content">Run-Time Domain Selection</span><a class="self-link" href="#run-time-domain-selection"></a></h3>
   <p>The following code shows the abstract base class for runtime selection
of RCU domains.</p>
<pre class="language-c++ highlight"><span class="n">class</span> <span class="n">rcu_domain</span> <span class="p">{</span>
<span class="nl">public</span><span class="p">:</span>
  <span class="n">virtual</span> <span class="kt">void</span> <span class="n">register_thread</span><span class="p">(</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">virtual</span> <span class="kt">void</span> <span class="nf">unregister_thread</span><span class="p">(</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">static</span> <span class="kr">inline</span> <span class="kt">bool</span> <span class="nf">register_thread_needed</span><span class="p">(</span><span class="p">)</span>
          <span class="p">{</span> <span class="k">return</span> true<span class="p">;</span> <span class="p">}</span>
  <span class="n">virtual</span> <span class="kt">void</span> <span class="nf">read_lock</span><span class="p">(</span><span class="p">)</span> <span class="n">noexcept</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">virtual</span> <span class="kt">void</span> <span class="nf">read_unlock</span><span class="p">(</span><span class="p">)</span> <span class="n">noexcept</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">virtual</span> <span class="kt">void</span> <span class="nf">synchronize</span><span class="p">(</span><span class="p">)</span> <span class="n">noexcept</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">virtual</span> <span class="kt">void</span> <span class="nf">call</span><span class="p">(</span><span class="n">class</span> <span class="n">rcu_head</span> <span class="o">*</span><span class="n">rhp</span><span class="p">,</span>
                    <span class="kt">void</span> <span class="n">cbf</span><span class="p">(</span><span class="n">rcu_head</span> <span class="o">*</span><span class="n">rhp</span><span class="p">)</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">virtual</span> <span class="kt">void</span> <span class="nf">barrier</span><span class="p">(</span><span class="p">)</span> <span class="n">noexcept</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">virtual</span> <span class="kt">void</span> <span class="nf">quiescent_state</span><span class="p">(</span><span class="p">)</span> <span class="n">noexcept</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">virtual</span> <span class="kt">void</span> <span class="nf">thread_offline</span><span class="p">(</span><span class="p">)</span> <span class="n">noexcept</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">virtual</span> <span class="kt">void</span> <span class="nf">thread_online</span><span class="p">(</span><span class="p">)</span> <span class="n">noexcept</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span><span class="p">;</span>
</pre>
   <p>Each domain creates a concrete subclass that implements its RCU APIs:</p>
   <ul>
    <li data-md="">
     <p>Bullet-proof RCU: <code class="highlight"><span class="k">class</span> <span class="nc">rcu_bp</span></code></p>
    <li data-md="">
     <p>Memory-barrier RCU: <code class="highlight"><span class="k">class</span> <span class="nc">rcu_mb</span></code></p>
    <li data-md="">
     <p>QSBR RCU: <code class="highlight"><span class="k">class</span> <span class="nc">rcu_qsbr</span></code></p>
    <li data-md="">
     <p>Signal-based RCU: <code class="highlight"><span class="k">class</span> <span class="nc">rcu_signal</span></code></p>
   </ul>
   <h2 class="heading settled" data-level="3" id="scoped-readers"><span class="secno">3. </span><span class="content">Scoped Readers</span><a class="self-link" href="#scoped-readers"></a></h2>
<pre class="language-c++ highlight"><span class="n">class</span> <span class="n">rcu_scoped_reader</span> <span class="p">{</span>
<span class="nl">public</span><span class="p">:</span>
  <span class="n">rcu_scoped_reader</span><span class="p">(</span><span class="p">)</span> <span class="n">noexcept</span>
  <span class="p">{</span>
    <span class="n">this</span><span class="o">-</span><span class="o">></span><span class="n">rd</span> <span class="o">=</span> <span class="n">nullptr</span><span class="p">;</span>
    <span class="n">rcu_read_lock</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">explicit</span> <span class="n">rcu_scoped_reader</span><span class="p">(</span><span class="n">rcu_domain</span> <span class="o">*</span><span class="n">rd</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">this</span><span class="o">-</span><span class="o">></span><span class="n">rd</span> <span class="o">=</span> <span class="n">rd</span><span class="p">;</span>
    <span class="n">rd</span><span class="o">-</span><span class="o">></span><span class="n">read_lock</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">rcu_scoped_reader</span><span class="p">(</span><span class="k">const</span> <span class="n">rcu_scoped_reader</span> <span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="n">delete</span><span class="p">;</span>

  <span class="n">rcu_scoped_reader</span><span class="o">&amp;</span><span class="n">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">rcu_scoped_reader</span> <span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="n">delete</span><span class="p">;</span>

   <span class="n">rcu_scoped_reader</span><span class="p">(</span><span class="p">)</span> <span class="n">noexcept</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">this</span><span class="o">-</span><span class="o">></span><span class="n">rd</span><span class="p">)</span>
      <span class="n">this</span><span class="o">-</span><span class="o">></span><span class="n">rd</span><span class="o">-</span><span class="o">></span><span class="n">read_unlock</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="nf">rcu_read_unlock</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>

<span class="nl">private</span><span class="p">:</span>
  <span class="n">rcu_domain</span> <span class="o">*</span><span class="n">rd</span><span class="p">;</span>
<span class="p">}</span><span class="p">;</span>
</pre>
   <p>In some cases, it might be convenient to use a scoped style for RCU readers,
especially if the read-side critical section might be exited via exception.
The <code class="highlight"><span class="n">rcu_scoped_reader</span></code> class shown above may be used for this purpose.
An argumentless constructor uses the API, or an <code class="highlight"><span class="n">rcu_domain</span></code> class
may be passed to the constructor to use the specified RCU
implementation.</p>
   <p>This is intended to be used in a manner similar to <code class="highlight"><span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">lock_guard</span></code>.</p>
   <h2 class="heading settled" data-level="4" id="rcu-callback-handling"><span class="secno">4. </span><span class="content">RCU Callback Handling</span><a class="self-link" href="#rcu-callback-handling"></a></h2>
   <p>The traditional C-language RCU callback uses address arithmetic
to map from the <code class="highlight"><span class="n">rcu_head</span></code> structure to the enclosing struct,
for example, via the <code class="highlight"><span class="n">container_of</span><span class="p">(</span><span class="p">)</span></code> macro.
Of course, this approach also works for C++, but this section first
looks at some approaches that leverage C++ overloading and inheritance,
which has the benefit of avoiding macros and providing better type safety.
This will not be an either-or situation: Several of these approaches
are likely to be generally useful.</p>
   <h3 class="heading settled" data-level="4.1" id="derived-function-call"><span class="secno">4.1. </span><span class="content">Derived Function Call</span><a class="self-link" href="#derived-function-call"></a></h3>
<pre class="language-c++ highlight"><span class="n">template</span><span class="o">&lt;</span><span class="kr">typename</span> <span class="n">T</span><span class="p">,</span> <span class="kr">typename</span> <span class="n">D</span> <span class="o">=</span> <span class="n">default_delete</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span><span class="p">,</span>
  <span class="kt">bool</span> <span class="n">E</span> <span class="o">=</span> <span class="n">is_empty</span><span class="o">&lt;</span><span class="n">D</span><span class="o">></span><span class="o">:</span><span class="o">:</span><span class="n">value</span><span class="o">></span>
<span class="n">class</span> <span class="nl">rcu_head_delete</span><span class="p">:</span> <span class="n">private</span> <span class="n">rcu_head</span> <span class="p">{</span>
  <span class="n">D</span> <span class="n">deleter</span><span class="p">;</span>
<span class="nl">public</span><span class="p">:</span>
  <span class="k">static</span> <span class="kt">void</span> <span class="n">trampoline</span><span class="p">(</span><span class="n">rcu_head</span> <span class="o">*</span><span class="n">rhp</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">auto</span> <span class="n">rhdp</span> <span class="o">=</span> <span class="n">static_cast</span><span class="o">&lt;</span><span class="n">rcu_head_delete</span> <span class="o">*</span><span class="o">></span><span class="p">(</span><span class="n">rhp</span><span class="p">)</span><span class="p">;</span>
    <span class="k">auto</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">static_cast</span><span class="o">&lt;</span><span class="n">T</span> <span class="o">*</span><span class="o">></span><span class="p">(</span><span class="n">rhdp</span><span class="p">)</span><span class="p">;</span>
    <span class="n">rhdp</span><span class="o">-</span><span class="o">></span><span class="n">deleter</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="n">call</span><span class="p">(</span><span class="n">D</span> <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="p">}</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">deleter</span> <span class="o">=</span> <span class="n">d</span><span class="p">;</span>
    <span class="n">call_rcu</span><span class="p">(</span><span class="n">static_cast</span><span class="o">&lt;</span><span class="n">rcu_head</span> <span class="o">*</span><span class="o">></span><span class="p">(</span><span class="n">this</span><span class="p">)</span><span class="p">,</span> <span class="n">trampoline</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="n">call</span><span class="p">(</span><span class="n">rcu_domain</span> <span class="o">&amp;</span><span class="n">rd</span><span class="p">,</span> <span class="n">D</span> <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="p">}</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">deleter</span> <span class="o">=</span> <span class="n">d</span><span class="p">;</span>
    <span class="n">rd</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="n">static_cast</span><span class="o">&lt;</span><span class="n">rcu_head</span> <span class="o">*</span><span class="o">></span><span class="p">(</span><span class="n">this</span><span class="p">)</span><span class="p">,</span> <span class="n">trampoline</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span><span class="p">;</span>
</pre>
   <p>The <code class="highlight"><span class="n">rcu_head_derived</span></code> class provides overloaded <code class="highlight"><span class="n">call</span><span class="p">(</span><span class="p">)</span></code> methods,
as shown above.
These methods take a deleter and an optional <code class="highlight"><span class="n">rcu_domain</span></code> class instance.
The deleterâs operator() is invoked after a grace period.
The deleter type defaults to <code class="highlight"><span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">default_delete</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span></code>,
but one could also use a
custom functor class with an <code class="highlight"><span class="k">operator</span><span class="p">(</span><span class="p">)</span></code> that carries out teardown actions
before freeing the object, or a raw function pointer type such as <code class="highlight"><span class="kt">void</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="p">(</span><span class="n">T</span><span class="o">*</span><span class="p">)</span></code>, or a lambda type.
We recommend avoiding deleter types such as <code class="highlight"><span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">(</span><span class="n">T</span><span class="o">*</span><span class="p">)</span><span class="o">></span></code> (and also any other type requiring memory allocation) because
allocating memory on the free path can result in out-of-memory deadlocks.</p>
   <p>If an <code class="highlight"><span class="n">rcu_domain</span></code> is supplied, its <code class="highlight"><span class="n">call</span><span class="p">(</span><span class="p">)</span></code> member function is used, otherwise the <code class="highlight"><span class="n">call_rcu</span><span class="p">(</span><span class="p">)</span></code> free
function is used.</p>
   <p>The next section provides a specialization that only permits <code class="highlight"><span class="k">delete</span></code>,
which allows omitting the deleter, thus saving a bit of memory.</p>
   <h3 class="heading settled" data-level="4.2" id="derived-deletion"><span class="secno">4.2. </span><span class="content">Derived Deletion</span><a class="self-link" href="#derived-deletion"></a></h3>
<pre class="language-c++ highlight"><span class="n">template</span><span class="o">&lt;</span><span class="kr">typename</span> <span class="n">T</span><span class="p">,</span> <span class="kr">typename</span> <span class="n">D</span><span class="o">></span>
<span class="n">class</span> <span class="n">rcu_head_delete</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="n">D</span><span class="p">,</span>true<span class="o">></span><span class="o">:</span> <span class="n">private</span> <span class="n">rcu_head</span> <span class="p">{</span>
<span class="nl">public</span><span class="p">:</span>
  <span class="k">static</span> <span class="kt">void</span> <span class="n">trampoline</span><span class="p">(</span><span class="n">rcu_head</span> <span class="o">*</span><span class="n">rhp</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">auto</span> <span class="n">rhdp</span> <span class="o">=</span> <span class="n">static_cast</span><span class="o">&lt;</span><span class="n">rcu_head_delete</span> <span class="o">*</span><span class="o">></span><span class="p">(</span><span class="n">rhp</span><span class="p">)</span><span class="p">;</span>
    <span class="k">auto</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">static_cast</span><span class="o">&lt;</span><span class="n">T</span> <span class="o">*</span><span class="o">></span><span class="p">(</span><span class="n">rhdp</span><span class="p">)</span><span class="p">;</span>
    <span class="n">D</span><span class="p">(</span><span class="p">)</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="n">call</span><span class="p">(</span><span class="n">D</span> <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="p">}</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">call_rcu</span><span class="p">(</span><span class="n">static_cast</span><span class="o">&lt;</span><span class="n">rcu_head</span> <span class="o">*</span><span class="o">></span><span class="p">(</span><span class="n">this</span><span class="p">)</span><span class="p">,</span> <span class="n">trampoline</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="n">call</span><span class="p">(</span><span class="n">rcu_domain</span> <span class="o">&amp;</span><span class="n">rd</span><span class="p">,</span> <span class="n">D</span> <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="p">}</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">rd</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="n">static_cast</span><span class="o">&lt;</span><span class="n">rcu_head</span> <span class="o">*</span><span class="o">></span><span class="p">(</span><span class="n">this</span><span class="p">)</span><span class="p">,</span> <span class="n">trampoline</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span><span class="p">;</span>
</pre>
   <p>By far the most common RCU callback simply frees the data structure.
The above code
shows a specialization of the <code class="highlight"><span class="n">rcu_head_delete</span></code> class, which supports
this idiom in cases where the RCU-protected data structure may inherit
from this class.</p>
   <p>The <code class="highlight"><span class="n">rcu_head_delete</span></code> class supplies a pair of overloaded <code class="highlight"><span class="n">call</span><span class="p">(</span><span class="p">)</span></code> member functions, the first of which has no non-defaulted argument.
This argument-free member function arranges to <code class="highlight"><span class="k">delete</span></code> the
object after a grace period, using <code class="highlight"><span class="n">call_rcu</span><span class="p">(</span><span class="p">)</span></code> to do so.</p>
   <p>The second <code class="highlight"><span class="n">call</span><span class="p">(</span><span class="p">)</span></code> member function takes an <code class="highlight"><span class="n">rcu_domain</span></code> argument, and uses that domainâs <code class="highlight"><span class="n">call_rcu</span><span class="p">(</span><span class="p">)</span></code> function to wait
for a grace period.</p>
   <p>Use of this approach is quite straightforward.
For example, a class <code class="highlight"><span class="n">foo</span></code> would inherit from <code class="highlight"><span class="n">rcu_head_delete</span><span class="o">&lt;</span><span class="n">foo</span><span class="o">></span></code>, and given a <code class="highlight"><span class="n">foo</span></code> pointer <code class="highlight"><span class="n">fp</span></code>,
would execute <code class="highlight"><span class="n">fp</span><span class="o">-</span><span class="o">></span><span class="n">call</span><span class="p">(</span><span class="p">)</span></code> to cause the object referenced
by <code class="highlight"><span class="n">fp</span></code> to be passed to <code class="highlight"><span class="k">delete</span></code> at the end of a subsequent
grace period.
No further action is required.</p>
   <p>However, it is sometimes necessary to do more than simply free an
object.
In many cases, additional teardown actions are required, and
it is often necessary to use a non-standard deallocator instead
of the C++ <code class="highlight"><span class="k">delete</span></code>.
This possibility is covered by another specialization of the <code class="highlight"><span class="n">rcu_head_delete</span></code> class, which was described in the previous section.</p>
   <h3 class="heading settled" data-level="4.3" id="pointer-to-enclosing-class"><span class="secno">4.3. </span><span class="content">Pointer To Enclosing Class</span><a class="self-link" href="#pointer-to-enclosing-class"></a></h3>
<pre class="language-c++ highlight"><span class="n">template</span><span class="o">&lt;</span><span class="kr">typename</span> <span class="n">T</span><span class="o">></span>
<span class="n">class</span> <span class="nl">rcu_head_ptr</span><span class="p">:</span> <span class="n">public</span> <span class="n">rcu_head</span> <span class="p">{</span>
<span class="nl">public</span><span class="p">:</span>
  <span class="n">rcu_head_ptr</span><span class="p">(</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">this</span><span class="o">-</span><span class="o">></span><span class="n">container_ptr</span> <span class="o">=</span> <span class="n">nullptr</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">rcu_head_ptr</span><span class="p">(</span><span class="n">T</span> <span class="o">*</span><span class="n">containing_class</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">this</span><span class="o">-</span><span class="o">></span><span class="n">container_ptr</span> <span class="o">=</span> <span class="n">containing_class</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">static</span> <span class="kt">void</span> <span class="n">trampoline</span><span class="p">(</span><span class="n">rcu_head</span> <span class="o">*</span><span class="n">rhp</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">T</span> <span class="o">*</span><span class="n">obj</span><span class="p">;</span>
    <span class="n">rcu_head_ptr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span> <span class="o">*</span><span class="n">rhdp</span><span class="p">;</span>

    <span class="n">rhdp</span> <span class="o">=</span> <span class="n">static_cast</span><span class="o">&lt;</span><span class="n">rcu_head_ptr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span> <span class="o">*</span><span class="o">></span><span class="p">(</span><span class="n">rhp</span><span class="p">)</span><span class="p">;</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">rhdp</span><span class="o">-</span><span class="o">></span><span class="n">container_ptr</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">rhdp</span><span class="o">-</span><span class="o">></span><span class="n">callback_func</span><span class="p">)</span>
      <span class="n">rhdp</span><span class="o">-</span><span class="o">></span><span class="n">callback_func</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="n">delete</span> <span class="n">obj</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="n">call</span><span class="p">(</span><span class="kt">void</span> <span class="n">callback_func</span><span class="p">(</span><span class="n">T</span> <span class="o">*</span><span class="n">obj</span><span class="p">)</span> <span class="o">=</span> <span class="n">nullptr</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">this</span><span class="o">-</span><span class="o">></span><span class="n">callback_func</span> <span class="o">=</span> <span class="n">callback_func</span><span class="p">;</span>
    <span class="n">call_rcu</span><span class="p">(</span><span class="n">static_cast</span><span class="o">&lt;</span><span class="n">rcu_head</span> <span class="o">*</span><span class="o">></span><span class="p">(</span><span class="n">this</span><span class="p">)</span><span class="p">,</span> <span class="n">trampoline</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="n">call</span><span class="p">(</span><span class="n">class</span> <span class="n">rcu_domain</span> <span class="o">&amp;</span><span class="n">rd</span><span class="p">,</span>
      <span class="kt">void</span> <span class="n">callback_func</span><span class="p">(</span><span class="n">T</span> <span class="o">*</span><span class="n">obj</span><span class="p">)</span> <span class="o">=</span> <span class="n">nullptr</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">this</span><span class="o">-</span><span class="o">></span><span class="n">callback_func</span> <span class="o">=</span> <span class="n">callback_func</span><span class="p">;</span>
    <span class="n">rd</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="n">static_cast</span><span class="o">&lt;</span><span class="n">rcu_head</span> <span class="o">*</span><span class="o">></span><span class="p">(</span><span class="n">this</span><span class="p">)</span><span class="p">,</span> <span class="n">trampoline</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>

<span class="nl">private</span><span class="p">:</span>
  <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">callback_func</span><span class="p">)</span><span class="p">(</span><span class="n">T</span> <span class="o">*</span><span class="n">obj</span><span class="p">)</span><span class="p">;</span>
  <span class="n">T</span> <span class="o">*</span><span class="n">container_ptr</span><span class="p">;</span>
<span class="p">}</span><span class="p">;</span>
</pre>
   <p>If complex inheritance networks make inheriting from an <code class="highlight"><span class="n">rcu_head</span></code> derived type impractical, one alternative is
to maintain a pointer to the enclosing class as shown in
the above figure.
This <code class="highlight"><span class="n">rcu_head_ptr</span></code> class is included as a member of the RCU-protected
class.
The <code class="highlight"><span class="n">rcu_head_ptr</span></code> classâs pointer must be initialized, for example,
in the RCU-protected classâs constructor.</p>
   <p>If the RCU-protected class is <code class="highlight"><span class="n">foo</span></code> and the name of the <code class="highlight"><span class="n">rcu_head_ptr</span></code> member function is <code class="highlight"><span class="n">rh</span></code>, then <code class="highlight"><span class="n">foo1</span><span class="p">.</span><span class="n">rh</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="n">my_cb</span><span class="p">)</span></code> would cause the function <code class="highlight"><span class="n">my_cb</span><span class="p">(</span><span class="p">)</span></code> to be
invoked after the end of a subsequent grace period.
As with the previous classes, omitting the deleter results
in the object being passed to <code class="highlight"><span class="k">delete</span></code> and an <code class="highlight"><span class="n">rcu_domain</span></code> object may be specified.</p>
   <h3 class="heading settled" data-level="4.4" id="address-arithmetic"><span class="secno">4.4. </span><span class="content">Address Arithmetic</span><a class="self-link" href="#address-arithmetic"></a></h3>
<pre class="language-c++ highlight"><span class="n">template</span><span class="o">&lt;</span><span class="kr">typename</span> <span class="n">T</span><span class="o">></span>
<span class="n">class</span> <span class="n">rcu_head_container_of</span> <span class="p">{</span>
<span class="nl">public</span><span class="p">:</span>
  <span class="k">static</span> <span class="kt">void</span> <span class="n">set_field</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">rcu_head</span> <span class="n">T</span><span class="o">:</span><span class="o">:</span><span class="o">*</span><span class="n">rh_field</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">T</span> <span class="n">t</span><span class="p">;</span>
    <span class="n">T</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">;</span>

    <span class="n">rh_offset</span> <span class="o">=</span> <span class="p">(</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="o">></span><span class="o">*</span><span class="n">rh_field</span><span class="p">)</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">p</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">static</span> <span class="n">T</span> <span class="o">*</span><span class="n">enclosing_class</span><span class="p">(</span><span class="k">struct</span> <span class="n">rcu_head</span> <span class="o">*</span><span class="n">rhp</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">T</span> <span class="o">*</span><span class="p">)</span><span class="p">(</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">rhp</span> <span class="o">-</span> <span class="n">rh_offset</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>

<span class="nl">private</span><span class="p">:</span>
  <span class="k">static</span> <span class="kr">inline</span> <span class="kt">size_t</span> <span class="n">rh_offset</span><span class="p">;</span>
<span class="p">}</span><span class="p">;</span>

<span class="n">template</span><span class="o">&lt;</span><span class="kr">typename</span> <span class="n">T</span><span class="o">></span>
<span class="kt">size_t</span> <span class="n">rcu_head_container_of</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span><span class="o">:</span><span class="o">:</span><span class="n">rh_offset</span><span class="p">;</span>
</pre>
   <p>The above code
shows an approach that can be used if memory is at a premium and
the inheritance techniques cannot be used.
The <code class="highlight"><span class="n">set_field</span><span class="p">(</span><span class="p">)</span></code> method sets the offset of the <code class="highlight"><span class="n">rcu_head_container_of</span></code> member within the enclosing RCU-protected
structure, and the <code class="highlight"><span class="n">enclosing_class</span><span class="p">(</span><span class="p">)</span></code> member function
applies that offset to translate a pointer to the <code class="highlight"><span class="n">rcu_head_container_of</span></code> member to the enclosing RCU-protected structure.</p>
<pre class="language-c++ highlight"><span class="kt">void</span> <span class="nf">my_cb</span><span class="p">(</span><span class="k">struct</span> <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">rcu_head</span> <span class="o">*</span><span class="n">rhp</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">struct</span> <span class="n">foo</span> <span class="o">*</span><span class="n">fp</span><span class="p">;</span>

  <span class="n">fp</span> <span class="o">=</span> <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">rcu_head_container_of</span><span class="o">&lt;</span><span class="k">struct</span> <span class="n">foo</span><span class="o">></span><span class="o">:</span><span class="o">:</span><span class="n">enclosing_class</span><span class="p">(</span><span class="n">rhp</span><span class="p">)</span><span class="p">;</span>
  <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">cout</span> <span class="o">&lt;</span><span class="o">&lt;</span> <span class="s">"</span><span class="s">Callback fp->a: </span><span class="s">"</span> <span class="o">&lt;</span><span class="o">&lt;</span> <span class="n">fp</span><span class="o">-</span><span class="o">></span><span class="n">a</span> <span class="o">&lt;</span><span class="o">&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<span class="p">}</span>
</pre>
   <p>This address arithmetic must be carried out in the callback function,
as shown in the above code.</p>
   <h2 class="heading settled" data-level="5" id="hazard-pointers-and-rcu"><span class="secno">5. </span><span class="content">Hazard Pointers and RCU: Which to Use?</span><a class="self-link" href="#hazard-pointers-and-rcu"></a></h2>
   <table bgcolor="#EEEEFF" cellpadding="4">
    <tbody>
     <tr>
      <td style="border-bottom: 1px solid black; border-right: 1px solid black;">
      <td style="border-bottom: 1px solid black;"> Reference Counting
      <td style="border-bottom: 1px solid black;"> Reference Counting with DCAS
      <td style="border-bottom: 1px solid black;"> RCU
      <td style="border-bottom: 1px solid black;"> Hazard Pointers 
     <tr>
      <td style="border-right: 1px solid black;">Unreclaimed objects
      <td bgcolor="#00dd00">Bounded
      <td bgcolor="#00dd00">Bounded
      <td> Unbounded
      <td bgcolor="#00dd00">Bounded 
     <tr>
      <td style="border-right: 1px solid black;"> Contention among readers 
      <td> Can be very high
      <td> Can be very high
      <td bgcolor="#00dd00">No contention
      <td bgcolor="#00dd00">No contention
     <tr>
      <td style="border-right: 1px solid black;"> Traversal forward progress 
      <td> Either blocking or lock-free with limited reclamation
      <td bgcolor="#00dd00"> Lock free
      <td bgcolor="#7777dd">Bounded population oblivious wait-free
      <td bgcolor="#00dd00"> Lock-free
     <tr>
      <td style="border-right: 1px solid black;"> Reclamation forward progress* 
      <td> Either blocking or lock-free with limited reclamation
      <td bgcolor="#00dd00">Lock free
      <td> Blocking
      <td bgcolor="#7777dd"> Bounded wait-free 
     <tr>
      <td style="border-right: 1px solid black;"> Traversal speed 
      <td> Atomic read-modify-write updates
      <td> Atomic read-modify-write updates
      <td bgcolor="#00dd00"> No or low overhead
      <td> Store-load fence
     <tr>
      <td style="border-right: 1px solid black;"> Reference acquisition
      <td bgcolor="#00dd00"> Unconditional
      <td bgcolor="#00dd00"> Unconditional
      <td bgcolor="#00dd00"> Unconditional
      <td> Conditional
     <tr>
      <td style="border-right: 1px solid black;"> Automatic reclamation 
      <td bgcolor="#00dd00">Yes
      <td bgcolor="#00dd00">Yes
      <td> No
      <td> No 
     <tr>
      <td style="border-right: 1px solid black;"> Purpose of domains 
      <td> N/A
      <td> N/A
      <td> Isolate long-latency readers
      <td> Limit contention, reduce space bounds, etc.
     <tr>
      <td colspan="5"><small>*  Does not include memory allocator, just the reclamation itself. </small>
   </table>
   <p class="issue" id="issue-f89111a0"><a class="self-link" href="#issue-f89111a0"></a> TODO: better formatting</p>
   <p>The above table
provides a rough summary of the relative advantages of reference
counting, RCU, and hazard pointers.
Advantages are marked in bold with green background, or with a blue
background for strong advantages.</p>
   <p>Although reference counting has normally had quite limited capabilities
and been quite tricky to apply for general linked data-structure
traversal, given a double-pointer-width compare-and-swap instruction,
it can work quite well, as shown in the "Reference Counting with DCAS"
column.</p>
   <p>As a rough rule of thumb, for best performance and scalability, you
should use RCU for read-intensive workloads and hazard pointers for
workloads that have significant update rates.
As another rough rule of thumb, a significant update rate has updates
as part of more than 10% of its operations.
Reference counting with DCAS is well-suited for small systems and/or
low read-side contention, and particularly on systems that have limited
thread-local-storage capabilities.
Both RCU and reference counting with DCAS allow unconditional reference
acquisition.</p>
   <p>Specialized workloads will have other considerations.
For example, small-memory multiprocessor systems might be best-served by
hazard pointers, while the read-mostly data structures in real-time
systems might be best-served by RCU.</p>
   <h2 class="heading settled" data-level="6" id="summary"><span class="secno">6. </span><span class="content">Summary</span><a class="self-link" href="#summary"></a></h2>
   <p>This paper demonstrates a way of creating C++ bindings for a C-language
RCU implementation, which has been tested against the userspace RCU
library.
We believe that these bindings are also appropriate for the type-oblivious
C++ RCU implementations that information-hiding considerations are likely
to favor.</p>
   <h2 class="heading settled" data-level="7" id="acknowledgments"><span class="secno">7. </span><span class="content">Acknowledgments</span><a class="self-link" href="#acknowledgments"></a></h2>
   <p>We owe thanks to Pedro Ramalhete for his review and comments.
We are grateful to Jim Wasko for his support of this effort.</p>
  </main>
<script>
(function() {
  "use strict";
  var collapseSidebarText = '<span aria-hidden="true">â</span> '
                          + '<span>Collapse Sidebar</span>';
  var expandSidebarText   = '<span aria-hidden="true">â</span> '
                          + '<span>Pop Out Sidebar</span>';
  var tocJumpText         = '<span aria-hidden="true">â</span> '
                          + '<span>Jump to Table of Contents</span>';

  var sidebarMedia = window.matchMedia('screen and (min-width: 78em)');
  var autoToggle   = function(e){ toggleSidebar(e.matches) };
  if(sidebarMedia.addListener) {
    sidebarMedia.addListener(autoToggle);
  }

  function toggleSidebar(on) {
    if (on == undefined) {
      on = !document.body.classList.contains('toc-sidebar');
    }

    /* Donât scroll to compensate for the ToC if weâre above it already. */
    var headY = 0;
    var head = document.querySelector('.head');
    if (head) {
      // terrible approx of "top of ToC"
      headY += head.offsetTop + head.offsetHeight;
    }
    var skipScroll = window.scrollY < headY;

    var toggle = document.getElementById('toc-toggle');
    var tocNav = document.getElementById('toc');
    if (on) {
      var tocHeight = tocNav.offsetHeight;
      document.body.classList.add('toc-sidebar');
      document.body.classList.remove('toc-inline');
      toggle.innerHTML = collapseSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, 0 - tocHeight);
      }
      tocNav.focus();
      sidebarMedia.addListener(autoToggle); // auto-collapse when out of room
    }
    else {
      document.body.classList.add('toc-inline');
      document.body.classList.remove('toc-sidebar');
      toggle.innerHTML = expandSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, tocNav.offsetHeight);
      }
      if (toggle.matches(':hover')) {
        /* Unfocus button when not using keyboard navigation,
           because I donât know where else to send the focus. */
        toggle.blur();
      }
    }
  }

  function createSidebarToggle() {
    /* Create the sidebar toggle in JS; it shouldnât exist when JS is off. */
    var toggle = document.createElement('a');
      /* This should probably be a button, but appearance isnât standards-track.*/
    toggle.id = 'toc-toggle';
    toggle.class = 'toc-toggle';
    toggle.href = '#toc';
    toggle.innerHTML = collapseSidebarText;

    sidebarMedia.addListener(autoToggle);
    var toggler = function(e) {
      e.preventDefault();
      sidebarMedia.removeListener(autoToggle); // persist explicit off states
      toggleSidebar();
      return false;
    }
    toggle.addEventListener('click', toggler, false);


    /* Get <nav id=toc-nav>, or make it if we donât have one. */
    var tocNav = document.getElementById('toc-nav');
    if (!tocNav) {
      tocNav = document.createElement('p');
      tocNav.id = 'toc-nav';
      /* Prepend for better keyboard navigation */
      document.body.insertBefore(tocNav, document.body.firstChild);
    }
    /* While weâre at it, make sure we have a Jump to Toc link. */
    var tocJump = document.getElementById('toc-jump');
    if (!tocJump) {
      tocJump = document.createElement('a');
      tocJump.id = 'toc-jump';
      tocJump.href = '#toc';
      tocJump.innerHTML = tocJumpText;
      tocNav.appendChild(tocJump);
    }

    tocNav.appendChild(toggle);
  }

  var toc = document.getElementById('toc');
  if (toc) {
    createSidebarToggle();
    toggleSidebar(sidebarMedia.matches);

    /* If the sidebar has been manually opened and is currently overlaying the text
       (window too small for the MQ to add the margin to body),
       then auto-close the sidebar once you click on something in there. */
    toc.addEventListener('click', function(e) {
      if(e.target.tagName.toLowerCase() == "a" && document.body.classList.contains('toc-sidebar') && !sidebarMedia.matches) {
        toggleSidebar(false);
      }
    }, false);
  }
  else {
    console.warn("Canât find Table of Contents. Please use <nav id='toc'> around the ToC.");
  }

  /* Wrap tables in case they overflow */
  var tables = document.querySelectorAll(':not(.overlarge) > table.data, :not(.overlarge) > table.index');
  var numTables = tables.length;
  for (var i = 0; i < numTables; i++) {
    var table = tables[i];
    var wrapper = document.createElement('div');
    wrapper.className = 'overlarge';
    table.parentNode.insertBefore(wrapper, table);
    wrapper.appendChild(table);
  }

})();
</script>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-mathieudesnoyers2009urcu">[MathieuDesnoyers2009URCU]
   <dd>M. Desnoyers. <a href="http://liburcu.org">[{RFC} git tree] userspace {RCU} (urcu) for {Linux}.</a>. URL: <a href="http://liburcu.org">http://liburcu.org</a>
   <dt id="biblio-p0098r1">[P0098R1]
   <dd>Paul E. McKenney, Torvald Riegel, Jeff Preshing, Hans Boehm, Clark Nelson, Olivier Giroux, Lawrence Crowl. <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0098r1.pdf">Towards Implementation and Use of memory order consume</a>. 4 January 2016. URL: <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0098r1.pdf">http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0098r1.pdf</a>
   <dt id="biblio-p0190r2">[P0190R2]
   <dd>Paul E. McKenney, Michael Wong, Hans Boehm, Jens Maurer, Jeffrey Yasskin, JF Bastien. <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0190r2.pdf">Proposal for New memory order consume Definition</a>. 25 May 2016. URL: <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0190r2.pdf">http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0190r2.pdf</a>
   <dt id="biblio-p0232r0">[P0232R0]
   <dd>Paul McKenney, Michael Wong, Maged Michael. <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0232r0.pdf">A Concurrency ToolKit for Structured Deferral/Optimistic Speculation</a>. 12 February 2016. URL: <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0232r0.pdf">http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0232r0.pdf</a>
   <dt id="biblio-p0279r1">[P0279R1]
   <dd>Paul E. McKenney. <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0279r1.pdf">Read-Copy Update (RCU) for C++</a>. 25 August 2016. URL: <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0279r1.pdf">http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0279r1.pdf</a>
   <dt id="biblio-p0462r0">[P0462R0]
   <dd>Hans Boehm, Clark Nelson, Olivier Giroux, Lawrence Crowl, JF Bastien, Micheal Wong. <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0462r0.pdf">Marking memory order consume Dependency Chains</a>. 13 October 2016. URL: <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0462r0.pdf">http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0462r0.pdf</a>
   <dt id="biblio-paulemckenney2015readmostly">[PaulEMcKenney2015ReadMostly]
   <dd>P. E. McKenney. <a href="http://lwn.net/Articles/667593/">Recent read-mostly research in 2015.</a>. URL: <a href="http://lwn.net/Articles/667593/">http://lwn.net/Articles/667593/</a>
   <dt id="biblio-paulmckenney2013lwnurcu">[PaulMcKenney2013LWNURCU]
   <dd>P. E. McKenney; M. Desnoyers; L. Jiangshan. <a href="https://lwn.net/Articles/573424/">User-space {RCU}.</a>. URL: <a href="https://lwn.net/Articles/573424/">https://lwn.net/Articles/573424/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> TODO: better formatting<a href="#issue-f89111a0"> âµ </a></div>
  </div>